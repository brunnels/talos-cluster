---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name simplyblock-pvc-keys
spec:
  refreshInterval: 12h
  secretStoreRef:
    kind: ClusterSecretStore
    name: akeyless-secret-store
  target:
    name: *name
    template:
      data:
        crypto_key1: "{{ .SB_CRYPTO_KEY1 }}"
        crypto_key2: "{{ .SB_CRYPTO_KEY2 }}"
  dataFrom:
    - extract:
        key: "${VAULT_PREFIX}/simplyblock"
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: simplyblock-csi
spec:
  refreshInterval: 12h
  secretStoreRef:
    kind: ClusterSecretStore
    name: akeyless-secret-store
  target:
    name: simplyblock-csi-secret
    template:
      data:
        secret.json: |-
          {
            "simplybk": {
              "secret": "{{ .SB_CSI_SECRET }}"
            },
            "simplybkPvc": [
              {
                "crypto_key1": "{{ .SB_CRYPTO_KEY1 }}",
                "crypto_key2": "{{ .SB_CRYPTO_KEY2 }}"
              }
            ]
          }
  dataFrom:
    - extract:
        key: "${VAULT_PREFIX}/simplyblock"
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: simplyblock-csi-v2
spec:
  refreshInterval: 12h
  secretStoreRef:
    kind: ClusterSecretStore
    name: akeyless-secret-store
  target:
    name: simplyblock-csi-secret-v2
    template:
      data:
        secret.json: |-
          {
            "clusters": [
              {
                "cluster_id": "{{ .SB_CLUSTER_UUID }}",
                "cluster_endpoint": "{{ .SB_CLUSTER_ENDPOINT }}",
                "cluster_secret": "{{ .SB_CSI_SECRET }}"
              }
            ]
          }
  dataFrom:
    - extract:
        key: "${VAULT_PREFIX}/simplyblock"
